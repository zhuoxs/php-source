<link href="../addons/ewei_shopv2/plugin/diypage/static/css/plu.min.css?v=20170609" rel="stylesheet" type="text/css"/>
<style type="text/css">
.fui-danmu:before {background: {$danmu['style']['background']}!important;}

opacity: {{$danmu[ 'style' ][ 'opacity' ]}}
</style>
<a class="fui-danmu external {php echo $danmu['params']['style']==1?'style2':''}" href="{php echo $danmu['params']['linkurl']?$danmu['params']['linkurl']:'javascript:;'}"><img class="thumb" src="../addons/ewei_shopv2/static/images/nopic100.jpg"/>
    <div class="text">---</div>
    <div class="time">-秒前</div>
</a>
<script type="text/javascript">
    $(function () {
    var dm_json = JSON.parse('{php echo json_encode($danmu["data"])}');
        var  json = JSON.parse('{php echo json_encode($danmu)}');
        console.log(json);
    var dm_index = 0;

    if (typeof localStorage.getItem('danmuTimer') != 'undefined' ) {
        clearInterval(+localStorage.getItem('danmuTimer'));
    }

    var danmuTimer = setInterval(function () {
        var data = dm_json[dm_index];
        $(".fui-danmu").find('.thumb').attr('src', data.imgurl);
        $(".fui-danmu").find('.text').text("新订单来自 " + data.nickname);
        $(".fui-danmu").find('.time').text(data.time);
        if (dm_index == 0) {
            $(".fui-danmu").css('display', 'flex');
        } else {
            $(".fui-danmu").addClass('show').fadeIn();
        }
        if (dm_index == dm_json.length - 1) {
            dm_index = 0;
        } else {
            dm_index++;
        }
        setTimeout(function () {
            $(".fui-danmu").fadeOut();
        }, 2000);
    }, 5000);

    localStorage.setItem('danmuTimer', danmuTimer);
});</script>
