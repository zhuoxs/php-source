{template '_header'}

{template 'diypage/_common'}
<style>
    /*装修组件的复制*/
    .diy-toolbar{
        width: 132px;
        height: 48px;
        background: rgba(0,0,0,0.4);
        border-radius: 6px;
        position: absolute;
        left: 0;
        top: -59px;
        padding: 0 10px;

    }
    .diy-toolbar .item{
        width: 56px;
        height: 100%;
        text-align: center;
        color: #fff;
        font-size: 12px;
        float: left;
        cursor: pointer;
    }
    .diy-toolbar .item p{
        width: 100%;
    }
    .diy-toolbar .item p.icow{
        margin-top: 7px;
        margin-bottom: 6px;
    }
    .diy-toolbar .item p.txt{
        line-height: 1;
    }
</style>

<div class="page-header">当前位置：<span class="text-primary">
    {if $do=='edit'}编辑{else}新建{/if} {$typename} {if $pagetype!='mod'}页面{/if}
        {if !empty($page)}
            <small>{if $do=='edit'}({$page['name']}){elseif ($do=='add' && !empty($template) && !empty($template['data']))}(通过模板：{$template['name']} 创建){/if}</small>
        {/if}
    </span>
</div>

<div class="page-content">
    <div class="row relative w840">
        <div class="diy-phone" data-merch="{php echo intval($_W['merchid'])}">
            <div class="phone-head"></div>
            <div class="phone-body">
                <div class="phone-title" id="page">loading...</div>
                <div class="phone-main" id="phone">
                    <p style="text-align: center; line-height: 400px">您还没有添加任何元素</p>
                </div>
            </div>
            <div class="phone-foot"></div>
        </div>

        <div class="diy-editor form-horizontal" style="position: relative;" id="diy-editor">
            <div class="diy-toolbar">
                <div class="item copy btn-copy">
                    <p class="icow icow-fuzhilianjie1"></p>
                    <p class="txt">复制</p>
                </div>
                <div class="item delete btn-del">
                    <p class="icow icow-shanchu2"></p>
                    <p class="txt ">删除</p>
                </div>
            </div>
            <div class="editor-arrow"></div>
            <div class="inner"></div>
        </div>

        <div class="diy-menu">
            <div class="navs" id="navs"></div>
            <div class="action">
                <nav class="btn btn-default btn-sm" style="float: left; display: none" id="gotop"><i class="icon icon-top" style="font-size: 12px"></i> 返回顶部</nav>
                {if $pagetype=='sys'}
                    {ifp 'diypage.page.sys.savetemp'}
                        <nav class="btn btn-warning btn-sm btn-save" data-type="savetemp">另存为模板</nav>
                    {/if}
                {/if}
                {if $pagetype=='diy'}
                    {ifp 'diypage.page.diy.savetemp'}
                        <nav class="btn btn-warning btn-sm btn-save" data-type="savetemp">另存为模板</nav>
                    {/if}
                {/if}
                {if $pagetype=='plu'}
                    {ifp 'diypage.page.plu.savetemp'}
                        <nav class="btn btn-warning btn-sm btn-save" data-type="savetemp">另存为模板</nav>
                    {/if}
                {/if}
                <nav class="btn btn-primary btn-sm btn-save" data-type="save">保存{if $pagetype=='mod'}模块{else}页面{/if}</nav>
                {if $pagetype=='sys' || $pagetype=='diy' || $pagetype=='plu'}
                    {if $_GPC['type']!=5 && $page['type']!=5 && $_GPC['type']!=7 && $page['type']!=7 && $_GPC['type']!=8 && $page['type']!=8}
                    <nav class="btn btn-success btn-sm btn-save" data-type="preview">保存并预览</nav>
                    {/if}
                {/if}
            </div>
        </div>
    </div>

    {template 'diypage/_template'}
    {template 'diypage/_template_edit'}
</div>

<script type="text/javascript" src="./resource/components/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="./resource/components/ueditor/ueditor.all.min.js"></script>
<script type="text/javascript" src="./resource/components/ueditor/lang/zh-cn/zh-cn.js"></script>
<link rel="stylesheet" href="../addons/ewei_shopv2/static/js/dist/select2/select2.css">
<link rel="stylesheet" href="../addons/ewei_shopv2/static/js/dist/select2/select2-bootstrap.css">


<script language="javascript">
    var path = '../../plugin/diypage/static/js/diy.min';
    myrequire([path,'tpl','web/biz'],function(modal,tpl){
        modal.init({
            tpl: tpl,
            attachurl: "{$_W['attachurl']}",
            id: '{php echo intval($_GPC["id"])}',
            type: {$type},
            data: {if !empty($page['data'])}{php echo json_encode($page['data'])}{else}null{/if},
            diymenu: {php echo json_encode($diymenu)},
            diyadvs: {php echo json_encode($diyadvs)},
            levels: {if !empty($levels)}{php echo json_encode($levels)}{else}null{/if},
            merch: {if $_W['plugin']=='merch' && !empty($_W['merchid'])}1{else}0{/if},
            merchid: {if $_W['plugin']=='merch' && !empty($_W['merchid'])}{$_W['merchid']}{else}0{/if},
            plugins: {$hasplugins},
            shopset: {php echo json_encode($_W['shopset']['shop'])}
        });
    });
    function selectUrlCallback(href){
        var ue =  UE.getEditor('rich');
        if(href){
            ue.execCommand('link', {href: href, 'data-nocache': 'true'});
        }
    }
    function callbackGoods(data) {
        myrequire([path],function(modal) {
            modal.callbackGoods(data);
        });
    }
    function callbackCategory (data) {
        myrequire([path],function(modal) {
            modal.callbackCategory(data);
        });
    }
    function callbackGroup (data) {
        myrequire([path],function(modal) {
            modal.callbackGroup(data);
        });
    }
    function callbackMerch (data) {
        myrequire([path],function(modal) {
            modal.callbackMerch(data);
        });
    }
    function callbackMerchCategory (data) {
        myrequire([path],function(modal) {
            modal.callbackMerchCategory(data);
        });
    }
    function callbackMerchGroup (data) {
        myrequire([path],function(modal) {
            modal.callbackMerchGroup(data);
        });
    }
    function callbackSeckill (data) {
        myrequire([path],function(modal) {
            modal.callbackSeckill(data);
        });
    }
    function callbackCoupon (data) {
        myrequire([path],function(modal) {
            modal.callbackCoupon(data);
        });
    }

    function callbackData(data) {
        myrequire([path],function(modal) {
            modal.callbackData(data);
        });
    }


</script>

{template '_footer'}