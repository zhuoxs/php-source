{template '_header'}<div class="page-header">    当前位置：<span class="text-primary">其他设置</span></div><div class="page-content"><form action="{php echo webUrl('exchange/setting/other',array(),1);}" method="post" class="form-horizontal form-validate" novalidate="novalidate">    <div class="form-group">        <label class="col-lg control-label">入口设置</label>        <div class="col-sm-9 col-xs-12">            <p class="form-control-static">                {php echo mobileUrl('exchange',array('codetype'=>1,'all'=>1),1);}            </p>        </div>    </div>    <div class="form-group">        <label class="col-lg control-label">优惠券兑换通知</label>        <div class="col-sm-9 col-xs-12">            <input type="text" name="data[coupon_templateid]" class="form-control" value="{$res['coupon_templateid']}" />            <div class="help-block">公众平台模板消息编号: OPENTM415477060 (同分销业务处理通知 一个模板id) </div>            <div class="help-block">优惠券的发放或领取通知会优先使用客服消息发送图文消息，如果接收消息会员在４８小时没有互动，则使用模板消息,其他消息默认优先客服消息</div>        </div>    </div>    <br>    <div class="form-group">        <label class="col-lg control-label">通用入口规则</label>        <div class="col-sm-9 col-xs-12">            {php echo tpl_ueditor('rule', $res['rule']);}        </div>    </div>    <div class="form-group">        <label class="col-lg control-label">消息通知</label>        <div class="col-sm-9">            <table class="table table-responsive">                <tbody>                <tr>                    <td>余额兑换通知</td>                    <td>                        <select class="select2 is_advanced" name="data[exchange_balance_template]">                            <option value=''>[默认]默认余额兑换通知</option>                            {loop $template_group['exchange_balance'] $template_val}                            <option value="{$template_val['id']}" {if $data['exchange_balance_template'] == $template_val['id'] }selected{/if}>{$template_val['title']}</option>                            {/loop}                        </select>                    </td>                    <td style="text-align: right;" class="is_advanced">                        <label class="notice-default">                            <input type="hidden" name="data[exchange_balance_close_advanced]" value="{php echo intval($data['exchange_balance_close_advanced'])}" />                            <input class="js-switch small checkone" data-type="tpl-advanced"  data-tag="exchange_balance"  type="checkbox" value="{php echo intval($data['exchange_balance_close_advanced'])}" {if empty($data['exchange_balance_close_advanced'])}checked{/if}/>                        </label>                        <label style="display: none;">                            <img src="../addons/ewei_shopv2/static/images/loading.gif" width="20" alt=""/>                        </label>                    </td>                </tr>                <tr>                    <td>积分兑换通知</td>                    <td>                        <select class="select2 is_advanced" name="data[exchange_score_template]">                            <option value=''>[默认]默认积分兑换通知</option>                            {loop $template_group['exchange_score'] $template_val}                            <option value="{$template_val['id']}" {if $data['exchange_score_template'] == $template_val['id'] }selected{/if}>{$template_val['title']}</option>                            {/loop}                        </select>                    </td>                    <td style="text-align: right;" class="is_advanced">                        <label class="notice-default">                            <input type="hidden" name="data[exchange_score_close_advanced]" value="{php echo intval($data['exchange_score_close_advanced'])}" />                            <input class="js-switch small checkone" data-type="tpl-advanced"  data-tag="exchange_score"  type="checkbox" value="{php echo intval($data['exchange_score_close_advanced'])}" {if empty($data['exchange_score_close_advanced'])}checked{/if}/>                        </label>                        <label style="display: none;">                            <img src="../addons/ewei_shopv2/static/images/loading.gif" width="20" alt=""/>                        </label>                    </td>                </tr>                <tr>                    <td>余额充值通知</td>                    <td>                        <select class="select2 is_advanced" name="data[exchange_recharge_template]">                            <option value=''>[默认]默认余额充值通知</option>                            {loop $template_group['exchange_recharge'] $template_val}                            <option value="{$template_val['id']}" {if $data['exchange_recharge_template'] == $template_val['id'] }selected{/if}>{$template_val['title']}</option>                            {/loop}                        </select>                    </td>                    <td style="text-align: right;" class="is_advanced">                        <label class="notice-default">                            <input type="hidden" name="data[exchange_recharge_close_advanced]" value="{php echo intval($data['exchange_recharge_close_advanced'])}" />                            <input class="js-switch small checkone" data-type="tpl-advanced"  data-tag="exchange_recharge"  type="checkbox" value="{php echo intval($data['exchange_recharge_close_advanced'])}" {if empty($data['exchange_recharge_close_advanced'])}checked{/if}/>                        </label>                        <label style="display: none;">                            <img src="../addons/ewei_shopv2/static/images/loading.gif" width="20" alt=""/>                        </label>                    </td>                </tr>                </tbody>            </table>        </div>    </div><br>    <div class="form-group">        <label class="col-lg control-label">兑换码防刷</label>        <div class="col-sm-9">            <div class="input-group fixmore-input-group">                <span class="input-group-addon">连续输错</span>                <input type="text" class="form-control" name="mistake" value="{$res['mistake']}">                <span class="input-group-addon">次兑换码，冻结用户兑换资格</span>                <input type="text" class="form-control" name="freeze" value="{$res['freeze']}">                <span class="input-group-addon">天</span>            </div>        </div>    </div>    <div class="form-group">        <label class="col-lg control-label"></label>        <div class="col-sm-9">            <div class="input-group fixmore-input-group">                <span class="input-group-addon">每个用户每天在 <b style="color: red">所有 </b>兑换任务中限兑</span>                <input type="text" class="form-control" name="alllimit" value="{$res['alllimit']}">                <span class="input-group-addon">次</span>            </div>        </div>    </div>    <div class="form-group">        <label class="col-lg control-label"></label>        <div class="col-sm-9">            <div class="input-group fixmore-input-group">                <span class="input-group-addon">每个用户每天在 <b style="color: red">单个 </b>兑换任务中限兑</span>                <input type="text" class="form-control" name="grouplimit" value="{$res['grouplimit']}">                <span class="input-group-addon">次</span>            </div>            <br><b style="color: red">* 0或空白表示不做限制</b>        </div>    </div>    <div class="form-group">        <label class="col-lg control-label">存储二维码</label>        <div class="col-sm-9 col-xs-12">            {php $s = p('exchange')->noQrImg();}            <label class="radio-inline"><input type="radio" name="no_qrimg" value="0" {if empty($s)}checked{/if}>开启</label>            <label class="radio-inline"><input type="radio" name="no_qrimg" value="1" {if !empty($s)}checked{/if}>关闭</label>        </div>    </div>    <div class="form-group">        <label class="col-lg label-control"></label>        <div class="col-sm-9">            <button class="btn btn-primary">保存</button>        </div>    </div></form></div><script>    $(function () {        var sms =  {if !empty($opensms)}true{else}false{/if};        $(".is_advanced").show();        $(".w60").css('width', '70px');        if (sms){            $(".w200").css('width', '250px');        }else{            $(".w200").css('width', '550px');            $(".colstd").attr('colspan',2);        }        $(".js-switch").not(".checkhi").click(function () {            var next = $(this).next();            if(next.hasClass('checked')){                $(this).val("1").prev().val("0");            }else{                $(this).val("0").prev().val("1");            }        });        $(".checkhi").click(function () {            var trueval = $(this).prev().data('true');            var falseval = $(this).prev().data('false');            var next = $(this).next();            if(next.hasClass('checked')){                $(this).val("1").prev().val(trueval);            }else{                $(this).val("0").prev().val(falseval);            }        });        $(".checkall").click(function () {            var type = $(this).data('type');            var val = $(this).val();            if(val==0){                $(this).closest(".table").find(".checkone[data-type='"+type+"']").attr("checked","false").val("1").next().removeClass("checked").prev().prev().val("1");            }else{                $(this).closest(".table").find(".checkone[data-type='"+type+"']").attr("checked","true").val("0").next().addClass("checked").prev().prev().val("0");            }        });        $(".checkone").click(function () {            var _this =$(this);            var type = _this.data('type');            var val = _this.val();            var tag = _this.data('tag');            var stop = _this.data('stop');            if(stop==1)            {                return;            }            if(tag != '' && val==1) {                $(this).data('stop', 1);                $(this).parent().hide().next().show();                var data = {                    'tag': tag,                    checked:val                };                $.ajax({                    url: "{php echo webUrl('sysset/settemplateid')}",                    type:'get',                    dataType:'json',                    timeout : 3000, //超时时间设置，单位毫秒                    data:data,                    success:function(ret){                        var _this = $(".checkone[data-tag='"+ret.result.tag+"']");                        if (ret.result.status == '0') {                            this.value=0;                            _this.prev().val(1);                            _this.next().removeClass('checked');                            console.log(ret.result.messages);                            alert(ret.result.messages);                        }                        $(_this).data('stop', 0);                        $(_this).parent().show().next().hide();                    },                    error: function(XMLHttpRequest, textStatus, errorThrown) {                        $(".table").each(function () {                            var _this = $(this);                            _this.find(".checkone[data-type='tpl-advanced']").each(function () {                                $(this).data('stop', 0);                                $(this).parent().show().next().hide();                            });                        });                    }                });            }            var type = $(this).data('type');            var val = $(this).val();            if(val==0){                $(this).attr("checked","false").val("1").next().removeClass("checked");                $(this).closest(".table").find(".checkall[data-type='"+type+"']").val("1").attr("checked","false").next().removeClass("checked");            }else{                $(this).attr("checked","true").val("0").next().addClass("checked");                var all = true;                $(this).closest(".table").find(".checkone[data-type='"+type+"']").each(function () {                    var val = $(this).val();                    if(val!='on' && val==1){                        all = false;                        return;                    }                });                if(all){                    $(this).closest(".table").find(".checkall[data-type='"+type+"']").val("0").attr("checked","true").next().addClass("checked");                }            }        });        $(".table").each(function () {            var _this = $(this);            var all_tpl_normal = true;            var all_tpl_advanced = true;            var all_sms = true;            _this.find(".checkone[data-type='tpl-advanced']").each(function () {                var val = $(this).val();                if(val!='on' && val==1){                    all_tpl_advanced = false;                    return;                }            });            _this.find(".checkone[data-type='sms']").each(function () {                var val = $(this).val();                if(val!='on' && val==1){                    all_sms = false;                    return;                }            });            if(all_tpl_normal){                _this.find(".checkall[data-type='tpl-normal']").val("0").attr("checked","true").next().addClass("checked");            }            if(all_tpl_advanced){                _this.find(".checkall[data-type='tpl-advanced']").val("0").attr("checked","true").next().addClass("checked");            }            if(all_sms){                _this.find(".checkall[data-type='sms']").val("0").attr("checked","true").next().addClass("checked");            }        });    })</script>{template '_footer'}