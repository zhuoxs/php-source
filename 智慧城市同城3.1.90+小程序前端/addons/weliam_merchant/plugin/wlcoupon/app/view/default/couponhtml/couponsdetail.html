{php include wl_template('common/header');}
<style>
	.bott{margin-bottom: 1rem;}
	.shop-panel {
	    padding: 21px 12px 12px;
	    color: #FFF;
	    position: relative;
	}
	.logo-area {
	    margin-bottom: 7px;
	}
	.logo-area .logo {
	    width: 38px;
	    height: 38px;
	    padding-top: 0;
	    margin-right: 7px;
	    border-radius: 22px;
	    border: 1px solid #d3d3d3;
	}
	.logo-area .logo img {
	    width: 38px;
	    height: 38px;
	    border-radius: 22px;
	}
	.clear {
	    width: 100%;
	    height: 0;
	    clear: both;
	}
	.tick-msg {
	    text-align: center;
	    margin-bottom: 6px;
	    color: #fff;
	}
	.tick-msg b {
	    font-weight: normal;
	    font-size: 24px;
	    color: #fff;
	}
	.deco {
	    position: absolute;
	    bottom: -1px;
	    left: 0;
	    width: 100%;
	    height: 5px;
	    background: url(./images/card_tpl.png) repeat-x;
	}
	p {
	    display: block;
	    -webkit-margin-before: 1em;
	    -webkit-margin-after: 1em;
	    -webkit-margin-start: 0px;
	    -webkit-margin-end: 0px;
	}
	.card-dispose {
	    padding: 15px 0;
	    border-bottom: 1px solid #e7e7eb;
	    margin-bottom: 15px;
	    background: #fff;
	    position: relative;
	}
	.barcode {
	    width: 320px;
	    height: 200px;
	    margin: 0 auto;
	    text-align: center;
	}
	.barcode img{
		width: 70%;
	}
	.code_num {
	    font-size: 15px;
	    text-align: center;
	    margin-bottom: 10px;
	}
	.li-panel {
	    padding: 11px 30px 11px 0;
	    display: block;
	    border-bottom: 1px solid #e7e7eb;
	}
	.tohave{width:50%;padding: 10px 30px;background-color: lawngreen;border-radius: 10px;text-align: center;color: white;margin-bottom: 30px;}
	.topay{width:50%;padding: 10px 30px;background-color: orangered;border-radius: 10px;text-align: center;color: white;margin-bottom: 30px;}
	#couponnum{
		border: 1px solid #ccc;
		box-shadow: 0 0 3px rgba(0,100,255,.1);
		border-radius: 2px;
	}
	.pickList .picker-item{
		width: 100% !important;
		display: block !important;
	}
	.picker-items-col{
		width: 100% !important;
		display: block !important;
	}
	.picker-items-col-wrapper{
		width: 100% !important;
		display: block !important;
	}
	.fwb p{margin-top: 6px;margin-bottom: 6px;}
</style>
<div class="content">
	<div class="card_section area" style="position: relative">
		<div class="shop-panel" id="color-purview" bgc="{$coupons['color']}" style="background: #a9d92d">
			<div class="logo-area">
				<span class="logo pull-left"><img src="{$coupons['storelogo']}" alt="" onerror=""></span>
				<div class="pull-left" style="height:38px;line-height:38px" id="brand_name">{$coupons['storename']}</div>
				<div class="clear"></div>
			</div>
			<div class="msg-area">
				<div class="tick-msg">
					<p><b id="title-purview">{$coupons['title']}</b></p>
					<p id="sub-title-purview">{$coupons['sub_title']}</p>
				</div>
				<p style="text-align: center">启用时间:<span id='qytime'>{$starttime}</span></p>
				<p style="text-align: center">失效时间:<span id='sxtime'>{$endtime}</span></p>
			</div>
			<div class="deco"></div>
			<div class="cicon" style="display: none;">
				<a href="javascript:;" data-id="form1"><i class="fa fa-pencil"></i></a>
			</div>
		</div>
	</div>
	<div class="card-dispose area">
		<div class="destroy_type_preview">
			<div class="barcode-area code_preview code_preview_3" style="display: block">
				<div class="barcode"><img src="{php echo app_url('store/merchant/qrcodeimg',array('url' => $url))}"></div>
			</div>
			<p style="text-align: center" id="notice-purview">请在付款时出示此券</p>
		</div>
		<div class="cicon" style="display: none;">
			<a href="javascript:;" data-id="form2"><i class="fa fa-pencil"></i></a>
		</div>
	</div>
	<div class="list-block bott">
		<!--说明内容-->
		<ul>
		{if $coupons['type']==1 || $coupons['type']==2}	
		<li class="align-top" >
            <div class="item-inner" style="padding-left: .75rem;">
                <div class="item-title label">卡券内容：</div>
                <div>{$content}</div>
            </div>
        </li>
        {else}
        <li class="align-top" style="border-bottom: 1px solid #F5F5F5;">
            <div style="padding: .75rem;">
                <div>卡券内容：</div>
                <div class="fwb">{$content}</div>
            </div>
        </li>
        {/if}
        <li class="align-top">
            <div class="item-inner" style="padding-left: .75rem;">
                <div class="item-title label">卡券剩余：</div>
                <div>{$coupons['surplus']}张</div>
            </div>
        </li>
        <li class="align-top">
            <div class="item-inner" style="padding-left: .75rem;">
                <div class="item-title label">卡券限购：</div>
                <div>{$coupons['get_limit']}张/人</div>
            </div>
        </li>
	   	 {if $coupons['is_charge']}
        	<li class="align-top">
            <div class="item-inner" style="padding-left: .75rem;">
                <div class="item-title label">卡券价格：</div>
                <div style="color: orangered;">￥{$coupons['price']}</div>
            </div>
        </li>
        {/if}
	   	<li class="align-top">
            <div class="item-inner" style="padding-left: .75rem;">
                <div class="item-title label">使用说明：</div>
                <div>{$coupons['description']}</div>
            </div>
        </li>
    </ul>
	</div>
	<center>
	{if $coupons['is_charge']}
	<a href="javascript:;">
	<div class="topay">立即购买</div>
	</a>
	{else}
	<a href="{php echo app_url('wlcoupon/coupon_app/getCoupon',array('id' => $coupons['id']))}">
	<div class="tohave">立即领取</div>
	</a>
	{/if}
	</center>
	 <div id="paytype" class="list-block" style="display: none;margin-top: 0;">
        <div style="text-align: center;margin-bottom: 5px;">购买数量：<input type="number" value="1" id="couponnum" style="background-color: white;width: 50%;display: inline-block;height: 28px;margin-right: 5px;" />张</div> 
        <ul style="padding: 0;margin: 0;">
            <li class="item-content" id="wechat">
                <div class="item-media">
                    <img src="{URL_APP_IMAGE}rush/wei2.png" style="width: 1.45rem;height: 1.45rem;"></div>
                <div class="item-inner">
                    <div class="item-title">微信支付</div>
                    <div class="item-after"><span>{$coupons['price']}元</span></div>
              	</div>
            </li>
            <!--<li class="item-content" id="credit">
            <div class="item-media" ><img src="{URL_APP_IMAGE}rush/yu.png" style="width: 1.45rem;height: 1.45rem;"></div>
            <div class="item-inner">
            <div class="item-title">余额支付<span style="font-size: 11px;">(剩余：￥{$credit['credit2']})</span></div>
            <div class="item-after">{$activity['price']}元</div></div>
            </li>
            <li class="item-content" id="other">
            <div class="item-media" ><img src="{URL_APP_IMAGE}rush/dai.png" style="width: 1.45rem;height: 1.45rem;"></div>
            <div class="item-inner">
            <div class="item-title">找人代付</div>
            <div class="item-after">{$activity['price']}元</div></div>
            </li>
            <li class="item-content" id="delivery">
            <div class="item-media" ><img src="{URL_APP_IMAGE}rush/huo.png" style="width: 1.45rem;height: 1.45rem;"></div>
            <div class="item-inner">
            <div class="item-title">货到付款</div>
            <div class="item-after">{$activity['price']}元</div></div>
            </li>-->
        </ul>
    </div>
</div>
<script>
	asd();
	function asd(){
		var color = $('#color-purview').attr('bgc');
		if (color == 'Color010') {
			$('#color-purview').css('background-color','#63B359');
		}else if(color == 'Color020'){
			$('#color-purview').css('background-color','#2c9f67');
		}else if(color == 'Color030'){
			$('#color-purview').css('background-color','#509fc9');
		}else if(color == 'Color040'){
			$('#color-purview').css('background-color','#5885cf');
		}else if(color == 'Color050'){
			$('#color-purview').css('background-color','#9062c0');
		}else if(color == 'Color060'){
			$('#color-purview').css('background-color','#d09a45');
		}else if(color == 'Color070'){
			$('#color-purview').css('background-color','#e4b138');
		}else if(color == 'Color080'){
			$('#color-purview').css('background-color','#ee903c');
		}else if(color == 'Color081'){
			$('#color-purview').css('background-color','#f08500');
		}else if(color == 'Color082'){
			$('#color-purview').css('background-color','#a9d92d');
		}else if(color == 'Color090'){
			$('#color-purview').css('background-color','#dd6549');
		}else if(color == 'Color100'){
			$('#color-purview').css('background-color','#cc463d');
		}else if(color == 'Color101'){
			$('#color-purview').css('background-color','#cf3e36');
		}else if(color == 'Color102'){
			$('#color-purview').css('background-color','#5e6671');
		}
	}
	$('.topay').click(function(){
		$('.topay').hide();
		$('#paytype').show();
	});
	$('.item-content').click(function(){
		var paytype = $(this).attr('id');
		var num = $('#couponnum').val();
		//alert(paytype);
            $.post("{php echo app_url('wlcoupon/coupon_app/createCouponorder',array('id'=>$coupons['id']))}", {num:num},
            function(d) {
            //	alert(JSON.stringify(d));
                if (d.errno) {
                    $.confirm(d.message,
                    function() { //确定后操作。
                    },
                    function() { //取消后操作。
                    });
                } else {
                    if (paytype == 'wechat') { //微信支付。
                        $.showIndicator(); //加载提示。
                        $.post("{php echo app_url('wlcoupon/coupon_app/cash')}", {
                            orderid: d.message,
                            paytype: paytype
                        },
                        function(m) {
                        //	alert(JSON.stringify(m));
                            if (!m.errno) { //验证通过，开始微信支付。
                            	$.hideIndicator(); //取消加载提示。
                                m.data.timeStamp = String(m.data.timeStamp);
                                WeixinJSBridge.invoke('getBrandWCPayRequest', {
                                    'appId': m.data.appid ? m.data.appid: m.data.appId,
                                    'timeStamp': m.data.timeStamp,
                                    'nonceStr': m.data.nonceStr,
                                    'package': m.data.package,
                                    'signType': m.data.signType,
                                    'paySign': m.data.paySign,
                                },
                                function(res) {
                                    if (res.err_msg == 'get_brand_wcpay_request:ok') { //支付成功。
                                        location.href = "{php echo app_url('wlcoupon/coupon_app/cash')}&orderid=" + d.message + "&paytype=" + paytype + "&done=1";
                                    } else { //支付失败。
                                        $.toast("已取消支付");
                                    }
                                });
                            } else {
                                $.confirm(m.message,
                                function() {
                                    history.go( - 1);
                                });
                            }

                        },
                        "json");
                    }
                }
            },
            "json");
        });
</script>
<script type="text/javascript">
	var numarr = Array();
	var num = {$coupons['get_limit']};
	for (var i=0;i<num;i++) {
		numarr[i] = i+1;
	}
	$("#couponnum").picker({
	  toolbarTemplate: '<header class="bar bar-nav">\
	  <button class="button button-link pull-right close-picker">确定</button>\
	  <h1 class="title">选择购买数量 (张)</h1>\
	  </header>',
	  cols: [
	    {
	      textAlign: 'center',
	      values: numarr
	    }
	  ],
	  cssClass:"pickList"
	});
</script>
{php include wl_template('common/footer');}