{php include wl_template('common/header');}
<link rel="stylesheet" href="{URL_MODULE}/plugin/pocket/app/resource/css/FL_index.css"/>
<link rel="stylesheet" href="{URL_MODULE}/plugin/pocket/app/resource/css/FL_list_detail.css"/>
<link rel="stylesheet" href="{URL_MODULE}/plugin/pocket/app/resource/css/libiao.css"/>
<link href="{URL_MODULE}/plugin/pocket/app/resource/css/global.css" rel="stylesheet"/>
<script src="{URL_MODULE}/plugin/pocket/app/resource/js/global.js"></script>
<script type="text/Javascript" src="{URL_MODULE}/plugin/pocket/app/resource/js/FL_index.js"></script>
<style>
    #hideRedEnvelope{
        width: 1.5rem;
        height: 1.5rem;
        line-height: 1.5rem;
        position: absolute;
        top: 0.6rem;
        right: 1rem;
        color: red;
        font-size: 2rem;
        z-index: 1;
    }
    #hideRedEnvelope i{
        width: 100%;
        height: 100%;
        font-size: 1.5rem;
    }
    #redEnvelope{
        display: none;
        position: absolute;
        z-index: 2000;
        width: 100%;
        text-align: center;
        height: 100%;
        background: RGBA(0,0,0,0.7);
        align-items: center;
    }
    #redEnvelope .getRedEnvelope{
        width: 11rem;
        height: 18rem;
        background: url("{URL_MODULE}/plugin/pocket/app/resource/images/redEnvelope.png") no-repeat;
        background-size: 100%;
        margin: auto;
        position: relative;
        display: none;
    }
    #redEnvelope .getRedEnvelope .redEnvelopeTotal{
        position: absolute;
        top: 2.5rem;
        width: 100%;
        font-size: 1rem;
        color: #fd3d3d;
    }
    #redEnvelope .getRedEnvelope #sendGetRedEnvelope{
        width: 4rem;
        height: 4rem;
        position: absolute;
        top: 5rem;
        left: 3.5rem;
        border-radius: 50%;
    }
    #redEnvelope .getRedEnvelope .nickname{
        position: absolute;
        width: 100%;
        top: 9.5rem;
        font-size: .8rem;
        color: #FFF;
    }
    #redEnvelope .getRedEnvelope .redEnvelopeSend{
        position: absolute;
        width: 100%;
        padding: 0 2rem;
        top: 10.8rem;
        font-size: .8rem;
        color: #FFF;
    }
    #redEnvelope .getRedEnvelope .redEnvelopeDetail{
        font-size: .75rem;
        color: #FFEB3B;
        position: absolute;
        bottom: 3rem;
        width: 100%;
        padding: 0 2rem;
    }
    #redEnvelope .getResult{
        width: 14rem;
        height: 25rem;
        background: url("{URL_MODULE}/plugin/pocket/app/resource/images/getResult.jpg") no-repeat;
        background-size: 100%;
        position: relative;
        margin: auto;
        display: none;
    }
    #redEnvelope .getResult .userAvatar{
        position: absolute;
        top: 1.3rem;
        height: 2.8rem;
        width: 100%;
    }
    #redEnvelope .getResult .userAvatar img{
        border-radius: 50%;
        height: 100%;
    }
    #redEnvelope .getResult .nickname{
        position: absolute;
        width: 100%;
        top: 4.5rem;
        font-size: .7rem;
        color: #FFF;
    }
    #redEnvelope .getResult .redEnvelopeSend{
        position: absolute;
        width: 100%;
        padding: 0 2rem;
        top: 5.8rem;
        font-size: .7rem;
        color: #FFF;
    }
    #redEnvelope .getResult .getMoney{
        position: absolute;
        width: 100%;
        bottom: 10rem;
        left: 1rem;
        font-size: .9rem;
        color: #fd4b49;
    }
    #redEnvelope .getResult .getMoney .detailMoney{
        font-size: 1.5rem;
    }
    #redEnvelope .getResult .popups{
        position: absolute;
        width: 100%;
        color: #ef9866;
        bottom: 6.8rem;
        font-size: .5rem;
        left: 1rem;
    }
    #redEnvelope .getResult .receiveList{
        position: absolute;
        width: 100%;
        bottom: 1.45rem;
        font-size: .6rem;
        left: .6rem;
        color: #fff4c7;
    }
    #redEnvelopeList{
        background: #FFF;
        border-top: 1px solid #f1f1f1;
        padding: .5rem;
        height: auto;
        width: 100%;
    }
    #redEnvelopeList .user{
        width: 9.5rem;
        display: inline-block;
        float: left;
    }
    #redEnvelopeList .user .avatar{
        width: 2rem;
        height: 2rem;
    }
    #redEnvelopeList .user .avatar img{
        width: 100%;
        height: 100%;
        border-radius: 50%;
    }
    #redEnvelopeList .user .nickname{
        float: left;
        margin-left: 0.5rem;
        height: 1rem;
        line-height: 1rem;
        width: 6.5rem;
    }
    #redEnvelopeList .user .receiveDate{
        font-size: .5rem;
        float: left;
        height: 1rem;
        line-height: 1rem;
        margin-left: .5rem;
    }
    #redEnvelopeList .receiveMoney{
        display: inline-block;
        width: calc(100% - 9.5rem);
        text-align: right;
        color: red;
        height: 2rem;
        line-height: 2rem;
    }
	#fenxiang_con {
		width:100%;
		height:100%;
		float:left;
		z-index:1010;
		position:fixed;
		display:none;
	}
	#fenxiang_con .fenxiang_con {
		width:100%;
		height:100%;
		float:left;
	}
	#fenxiang_con .fenxiang_con .fenxiang_con01 {
		width:100%;
		height:100%;
		background-color:rgba(0,0,0,.8);
		float:left;
		position:fixed;
		top:45px;
	}
	#fenxiang_con .fenxiang_con .fenxiang_con02 {
		float:right;
		position:fixed;
		top:60px;
		z-index:111;
		clear:both;
	}
</style>
<div class="page-group" >
    <div class="page page-current">
    	<div id="fenxiang_con">
		  <div class="fenxiang_con">
		    <div class="fenxiang_con01" style="top:0;"></div>
		    <div class="fenxiang_con02" style="top:0px;"><img src="{URL_MODULE}/plugin/pocket/app/resource/images/fenxiang.png" style="width:100%; height:auto"/></div>
		  </div>
		</div>
    	<header class="bar bar-nav newheader">
		    <a class="button button-link button-nav pull-left back" href="{php echo app_url('pocket/pocket/index')}">
		      <span class="icon icon-left"></span>
		      返回
		    </a>
		    <h1 class="title">{$typename}信息</h1>
		    <a class="button button-link button-nav pull-right" href="{php echo app_url('pocket/pocket/myinform',array('status'=>0))}">
			    <span class="icon iconfont icon-my"></span>
			</a>
		</header>
		<nav class="bar bar-tab bar-footer">
			{if $examineflag}
				<a class="right-btn external" href="javascript:;" id="nopass" style="background: #3d4145;">
			    	<text>拒绝通过</text>
			    </a>
			    <a class="right-btn external bg-red" href="javascript:;" onclick="pass(1)">
			    	<text>通过审核</text>
			    </a>
		    {else}
				<a class="tab-item external" href="{php echo app_url('pocket/pocket/index')}">
					<span class="icon iconfont icon-home"></span>
					<span class="tab-label">首页</span>
				</a>
				<a class="tab-item external" href="{php echo app_url('pocket/pocket/category')}">
					<span class="icon iconfont icon-voice"></span>
					<span class="tab-label">发布</span>
				</a>
				{if $inform['phone']}
				<a class="right-btn external" href="tel:{$inform['phone']}" style="width: 5%;">
					<text><i class="icon iconfont icon-phone"></i> 拨打电话</text>
				</a>
				{else}
				<a class="right-btn external" href="javascript:;" style="width: 5%;background: #bbb;">
					<text><i class="icon iconfont icon-phone"></i> 暂无电话</text>
				</a>
				{/if}
				{if $inform['sredpack'] > '0.00' && empty($userGRE) && $inform['package'] > 0 && $inform['redpackstatus'] > 0}
				<a class="right-btn external" href="javascript:;" id="getRedEnvelope" style="width: 3%;background:#161616;">
					<text>抢红包</text>
				</a>
				{/if}
		    {/if}
	    </nav>
		<div  class="content">
			<div class="Tz" style="background-color:#fff; margin-bottom:10px;">
			  	<div class="Tzs">
				    <!--帖子头部样式部分-->
				    <div class="Tzs01"> <span class="Tzs011"><img src="{php echo tomedia($avatar)}"/></span>
				      <div class="Tzs012" style="width:calc( 100% - 66px);">
				        <div class="Tzs0121">
				          <h4 class="Tzs01211" style="width:70%;height:25px;">{$inform['nickname']}</h4>
				          <div class="pro_fxs"> <i></i> <span>分享</span> </div>
				        </div>
				        <div class="Tzs0122">
				        	{if $inform['top']}
				            <span class="top-tag">置顶</span>
				            {/if}
							{if $inform['redpack'] > 0 && $inform['redpackstatus'] > 0  }
							<span class="top-tag">红包</span>
							{/if}
				          <time>{php echo date('m-d',$inform['createtime'])}发布</time>
				        </div>
				      </div>
				      <div class="Tzs013"> <em></em> </div>
				    </div>
				    
					{if $inform['keyword']}
					<div class="cl mb8">
						{loop $inform['keyword'] $y $keyword}
                        <span class="mod-feed-tag b-color{$y}">{$keyword}</span>
                        {/loop}
					</div>
				    {/if}
				    <div class="Tzs03" style="max-height: 1000%;">
				    	<p class="Tzs032" style="line-height:23px;">{$inform['content']}</p>
				    </div>
				    <!--配发图片部分-->
				    <ol class="Tzs04ss">
				    	{loop $inform['img'] $img}
						<li class="imgloading"><img class="specimg" src='{$img}'/></li>
				        {/loop}
				    </ol>
				    
				    <div class="Tzs04s">
				      	<ul class="Tzs06">
				        	<li class="Tzs064" onclick="dianzan($(this),'{$inform['id']}')"><em><img src="{URL_MODULE}/plugin/pocket/app/resource/images/zan1.png"/></em><i>{$inform['likenum']}</i></li>
				          	<li class="Tzs062"><em><img src="{URL_MODULE}/plugin/pocket/app/resource/images/zhuan.png"/></em><i id="sharenum">{$inform['share']}</i></li>
				           	<li class="Tzs061"><em><img src="{URL_MODULE}/plugin/pocket/app/resource/images/liulan.png"/></em><i>{$inform['look']}</i></li>
				      </ul>
				    </div>
			    	{if $likemember}
			    	<div class="r" id="r_1683"></div>
			        <ul class="zanlist" style="margin-bottom: 15px;overflow: hidden;height: 45px;">
			          	<li class="zannum" style="margin-right: 0px;">
			            	<p class="zannumdet">{$inform['likenum']}</p>
			            	<p>赞</p>
			          	</li>
			          	{loop $likemember $member}
			            <li style="margin-right:-15px;"><img src="{php echo tomedia($member)}"/></li>
			          	{/loop} 
			        </ul>
			        {/if}
			        
				    {if $set['remark']&& $inform['top'] < 2}  
					<div class="sysinfo">
						<p style="line-height:20px;color:{$set['remarkcolor']};font-size: 15px;margin: .5rem 0;">{$set['remark']}</p>
					</div>
					{/if}    
			  	</div>
			</div>
            <!--红包领取列表-->
            {if $inform['redpack'] && $inform['package'] && $inform['redpackstatus']}
                <div class="liuyan clearfix">
                    <div class="fl kuaibiao"></div>
                    <h1 class="fl">已抢{php echo count($getList)}/{$inform['package']}份</h1>
                </div>
                {if $getList}
                    {loop $getList $val}
                        <div id="redEnvelopeList">
                            <div class="user">
                                <div class="avatar"><img src="{php echo tomedia($val['avatar'])}"></div>
                                <div class="nickname">{$val['nickname']}</div>
                                <div class="receiveDate">{$val['gettime']}</div>
                            </div>
                            <div class="receiveMoney">{$val['money']}元</div>
                        </div>
                    {/loop}
                {/if}
            {/if}

			<!--地址-->
			{if $inform['locastatus']}
			<div class="liuyan clearfix navigation" data-lat="{$location['lat']}" data-lng="{$location['lng']}" data-name="{$inform['nickname']}" data-addr="{$inform['address']}" data-tel="{$inform['phone']}"  >
				<div class="fl kuaibiao"></div>
				<h1 class="fl">地址</h1>
				<div class="comment"><i></i><span>前往导航</span></div>
			</div>
			<div style="background-color: white;padding: 5px;">
				<p>{$inform['address']}</p>
			</div>
			{/if}
			<div class="liuyan clearfix">
			  <div class="fl kuaibiao"></div>
			  <h1 class="fl">评论</h1>
			  <div class="comment fabucomment"><i></i><span>我要评论</span></div>
			</div>
			<div id="FL_pl" data-id="1" data-infoid="1319" data-total-pages="0" data-page="1" data-s="0">
				{if $comment}
				{loop $comment $com}
				 <ul class="text_box">
				   <li class="ping_bottom">
				    <div class="liuyan-user fl "> 
				     <img src="{$com['avatar']}" /> 
				    </div>
				    <div class="name_box">
				     <p class="liuyan-name ">{$com['nickname']}</p>
				     <p class=" liuyan-time">{$com['time']}</p>
				    </div><span class="anniu-huifu fr" onclick="replay('{$com['id']}',$(this),1)" rel="{$com['nickname']}">回复</span><p class="liuyan_text clearfix">{$com['content']}</p>
				   {if $com['reply']}
					<div class="liuyan_huifu">
				     <div class="triangle"></div>
				     {loop $com['reply'] $re}
				     <div onclick="replay('{$re['id']}',$(this),2);" rel="{$re['sname']}">
				      <span class="yanse">{$re['sname']}</span>回复
				      <span class="yanse">{$re['aname']}</span>：{$re['content']}
				     </div>
				     {/loop}
				    </div>
				   {/if}
				   </li>
				 </ul>
				{/loop}
				{else}
			    <div class="FL_gengduo" >暂无任何评论</div>
				{/if}
			</div>
			</div>
			<!--评论部分-->
			<div class="erweima" id="dt_review_box" style="display:none;">
			  <div class="shurukuang">
			    <h3>评论</h3>
			    <textarea id="pinglun_input" class="pl_textarea" id="pinglun_input" placeholder="我也说一句..."></textarea>
			    <div class="qdqx">
			      <div class="qdqxl">取消</div>
			      <div class="qdqxr" id="form_post" flag='1'  tieziid = "{$inform['id']}" >留言</div>
			    </div>
			  </div>
			</div>
			<script>
			    $(function(){
			        $(".fabucomment").click(function(){
			        	{if empty($_W['mid'])}
						location.href = "{php echo app_url('member/user/signin',array('backurl'=>urlencode(app_url('pocket/pocket/detail',array('id'=>$id)))));}";
						{else}
			            $("#pinglun_input").attr("placeholder","我也说一句...");
			            $("#form_post").text("留言");
			            $("#form_post").attr("flag",1);
			            $("#form_post").attr("tieziid","{$inform['id']}");
			            $(".erweima").css('display','block'); 
						{/if}		
			        });
			        $('.qdqxl').click(function(){
			            $(".erweima").css('display','none'); 
			        });
			    })
			</script>
			<div class="wptConfirm">
			  	<div class="wptMask"></div>
			  	<div class="dialog">
			    	<div class="tip">
			     	 	<div class="msg"></div>
			    	</div>
			    	<div class="btns">
			      		<div class="btn-confirm sure btn-green">确定</div>
			      		<div class="btn-cancel">取消</div>
			    	</div>
			  	</div>
			</div>
			<div class="wptLoading">
				<div class="wptMask"></div>
				<div class="weui_toast">
				    <div class="weui_loading">
				       <img src="{URL_MODULE}/plugin/pocket/app/resource/images/loading.gif" />
				    </div>
				    <p class="weui_toast_content">数据加载中</p>
				</div>
			</div>
			<div class="wptMultiConfirm">
			    <div class="wptMask"></div>
			    <div class="dialog">
			        <div class="tip">
			            <div class="msg"></div>
			        </div>
			        <div class="btns">
			            <div class="btn-cancel">取消</div>
			        </div>
			    </div>
			</div>
	</div>
    <!--红包内容弹框-->
    <div id="redEnvelope">
        <!--关闭红包领取页面-->
        <div id="hideRedEnvelope"><i class="icon iconfont icon-close"></i></div>
        <!--领取红包内容-->
        <div class="getRedEnvelope">
            <div class="redEnvelopeTotal">总计:{$inform['redpack']}元</div>
            <div id="sendGetRedEnvelope" pid="{$inform['id']}"></div>
            <div class="nickname">{$inform['nickname']}</div>
            <div class="redEnvelopeSend">发送了一个红包</div>
            <div class="redEnvelopeDetail">领取的红包将自动存入您的余额</div>
        </div>
        <!--红包领取结果页面-->
        <div class="getResult">
            <div class="userAvatar"><img src="{php echo tomedia($avatar)}"/></div>
            <div class="nickname">{$inform['nickname']}</div>
            <div class="redEnvelopeSend">发送了一个红包</div>
            <div class="getMoney">￥<i class="detailMoney">0.02</i>元</div>
            <div class="popups">红包已发放到您的余额中</div>
        </div>
    </div>
</div>
<script>
	var ingflag = 0;
	
	$(".pro_fxs").click(function(){
		$("#share_popup").remove();
	    $("#fenxiang_con").css("display","block");
	});
	$("#fenxiang_con").click(function(){
	    $(this).css("display","none");
	});

	function todetail(){
		location.href="{php echo app_url('pocket/pocket/detail',array('id'=>$id))}";
	}
	$(function(){
		$(".specimg").css('width','100%');
	});
	function uploadcomment(id,val) {
	var mark=$.trim(val);
	if(ingflag){
		$.toast('留言中，请稍后');
		return false;
	}else{
		ingflag = 1;
	}
	if( mark.length<2 )
	{
		$.toast('您输入的留言内容太短');
		return false;
	}
	else if( mark.length>500  )
	{
		$.toast('您输入的留言内容太长');
		return false;
	}
	else
	{
		$.post("{php echo app_url('pocket/pocket/comment')}",{id:id,mark:mark},function(d){
			if(!d.errno) {
				$.toast('评论成功');
			    setTimeout("todetail()",1000);
			}else if(d.errno == 2){
				$.confirm(d.message,function () { //确定后操作。
						location.href = "{php echo app_url('pocket/pocket/detail')}"+"&id="+id;
				    },function () { //取消后操作。
				       
				    }
		    	);
			}else{
				$.toast(d.message);
			}
		},"json");
	}	
	return false;	
}
	function uploadcomment2(id,val,flag){
	var mark=$.trim(val);
	var inid = "{$inform['id']}";
	if(ingflag){
		$.toast('回复中，请稍后');
		return false;
	}else{
		ingflag = 1;
	}
	if( mark.length<2 )
	{
		$.toast('您输入的回复内容太短');
		return false;
	}
	else if( mark.length>500  )
	{
		$.toast('您输入的回复内容太长');
		return false;
	}
	else
	{
		$.post("{php echo app_url('pocket/pocket/replay')}",{id:id,mark:mark,flag:flag},function(d){
			if(!d.errno) {
				$.toast('回复成功');
			    setTimeout("todetail()",1000);
			}else if(d.errno == 2){
				$.confirm(d.message,function () { //确定后操作。
						location.href = "{php echo app_url('pocket/pocket/detail')}"+"&id="+inid;
				    },function () { //取消后操作。
				       
				    }
		    	);
			}else{
				$.toast(d.message);
			}
		},"json");
	}	
	return false;	
}
    function replay(a,o,flag){
        {if empty($_W['mid'])}
        location.href = "{php echo app_url('member/user/signin',array('backurl'=>urlencode(app_url('pocket/pocket/detail',array('id'=>$id)))));}";
        {else}
        var b=o.attr("rel");
        $("#dt_review_box").show();
        $("#pinglun_input").attr("placeholder",("回复"+b));
        $("#form_post").text("回复");
        if(flag == 1){
            $("#form_post").attr("flag",0);
        }else{
            $("#form_post").attr("flag",3);
        }
        $("#form_post").attr("tieziid",a);
        {/if}
    }
    function dianzan(o,tid){
        {if empty($_W['mid'])}
        location.href = "{php echo app_url('member/user/signin',array('backurl'=>urlencode(app_url('pocket/pocket/detail',array('id'=>$id)))));}";
        {else}
        o.children("em").children("img").attr("src","{URL_MODULE}/plugin/pocket/app/resource/images/zan2.png");
        o.css("color","#ed414a");
        $.post("{php echo app_url('pocket/pocket/dianzan_ajax')}", {cid:tid}, function(result){
            if(result.errno != 0) {
                $.toast(result.message);
            } else {
                var zans=parseInt(o.children("i").text());
                o.children("i").text(zans+1);
                $.toast('点赞成功');
            }
            return false;
        }, 'json');
        {/if}
    }
    $(document).on('click','#nopass', function () {
      $.prompt('请输入驳回原因', function (value) {
          $.post("{php echo app_url('pocket/pocket/pass',array('id'=>$inform['id']))}",{reason:value,flag:0},function(d){
            if(!d.errno){
                $.toast('驳回成功');
                location.href = "{php echo app_url('pocket/pocket/index')}";
            }else{
                $.toast('驳回失败');
            }
          },"json");
       });
    });

    function pass(flag){
        if(flag){
            var con = '通过';
        }else{
            var con = '不通过';
        }
        var id = "{$inform['id']}";
        $.confirm('确定'+con+'帖子的审核吗？',
            function() { //确定后操作。
                $.post("{php echo app_url('pocket/pocket/pass')}",{flag:flag,id:id},function(d){
                    if(d){
                        $.toast(con+'成功');
                        if(flag){
                            location.reload();
                        }else{
                            location.href = "{php echo app_url('pocket/pocket/index')}";
                        }
                    }else{
                        $.toast(con+'失败');
                    }
                }, 'json');
            },
            function() { //取消后操作。
        });
    }
    
    function shareover(){
	var id = "{$id}";
	$.post("{php echo app_url('pocket/pocket/fenxiang_ajax')}", {cid:id}, function(result){
			$.toast('感谢分享');
		}, 'json');
	}
    $.init();
</script>
<!--红包领取操作-->
<script>
    /**
     * 关闭红包领取页面
     */
    $("#hideRedEnvelope").on('click',function () {
        var state = $("#hideRedEnvelope").attr("state");
        if(state){
            history.go(0);
            return false;
        }
        $("#redEnvelope").css("display","none");
        $("#redEnvelope .getRedEnvelope").hide();
        $("#redEnvelope .getResult").hide();
    });
    /**
     * 弹出红包
     */
    $("#getRedEnvelope").on('click',function () {
        $(".pro_fxs").click();
        var html = '<span id="share_popup" style=" height: 30px;' +
            '    line-height: 30px;' +
            '    width: 100%;' +
            '    text-align: center;' +
            '    display: inline-block;' +
            '    font-size: 20px;' +
            '    color: #FFF;' +
            '    margin-top: 25px;">分享成功后好友访问即可获得红包!</span>';
        $(".fenxiang_con02").append(html);


        /*$("#redEnvelope").css("display","flex");
        $("#redEnvelope .getRedEnvelope").show();*/
    });
    /**
     * 领取红包操作
     */
    $("#sendGetRedEnvelope").on('click',function () {
        var pid = $(this).attr("pid");
        var url = "{php echo app_url('pocket/pocket/getRedEnvelope')}";
        $.post(url,{pid:pid},function (res) {
            if(res.errno == 0){
                var money = res.data;
                //红包领取完毕的操作
                $("#redEnvelope").css("display","flex");
                $("#hideRedEnvelope").attr("state",1);
                $("#redEnvelope .getRedEnvelope").hide();
                $("#redEnvelope .getResult").show();
                $("#redEnvelope .getResult .detailMoney").html(money);
            }else{
                $.alert(res.message);
            }
        },'json');
    });
</script>
{php include wl_template('common/footer');}
