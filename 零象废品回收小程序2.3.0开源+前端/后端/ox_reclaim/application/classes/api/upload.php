<?phpif (!(defined('IN_IA'))){    exit('Access Denied');}//上传图片class Api_Upload extends WeModuleWxapp{    public function save()    {        global $_GPC, $_W;        $file = $_FILES['file'];//得到传输的数据        if($file['error']==1){            $ift=ini_set('upload_max_filesize', '6M');            if(!$ift){                return $this->result(500,'上传图片最大不能超过'.ini_get('upload_max_filesize').'!','');            }            $file = $_FILES['file'];//得到传输的数据        }        //得到文件名称        $name = $file['name'];        $type = strtolower(substr($name,strrpos($name,'.')+1)); //得到文件类型，并且都转化成小写        $allow_type = array('jpg','jpeg','gif','png'); //定义允许上传的类型        //判断文件类型是否被允许上传        if(!in_array($type, $allow_type)){            //如果不被允许，则直接停止程序运行            //不存在显示入驻            return $this->result(500,'请上传\'jpg\',\'jpeg\',\'gif\',\'png\'类型的图片！','');        }        $imgname=$_GPC['names'].md5(random(5).time().$_W['uniacid']);        load()->func('file');        if (empty($_W['setting']['remote']['type'])) {            $files=file_upload($file, 'image', 'images/0xiang/'.$_W['uniacid'].'/'.$imgname.'.'.$type);            $re=['all'=>tomedia($files['path']),'short'=>$files['path']];            return $this->result(0,'上传成功！',$re);        }        $files=file_upload($file, 'image', 'images/'.MODEL_NAME.'/'.$_W['uniacid'].'/'.$imgname.'.'.$type);        @file_remote_upload($files['path']);        $re=['all'=>tomedia($files['path']),'short'=>$files['path']];        return $this->result(0,'上传成功！',$re);    }    //删除图片    public function delImg()    {        global $_GPC, $_W;        //拆分url链接去除开头，传值删除        $imgurl=$_GPC['imgurl'];        $fileurl=str_replace($_W['siteroot'].'attachment/','',$imgurl);        load()->func('file');        if (empty($_W['setting']['remote']['type'])) {            if(file_is_image($fileurl)){                @file_delete($fileurl);            }            return true;        }        $arr=explode('/',$imgurl);        file_remote_delete($arr[count($arr)-1]);        return true;    }}