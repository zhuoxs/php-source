<!DOCTYPE html>
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="viewport" content="width=640" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-title" content="">
		<meta name="format-detection" content="telephone=no">
		<title>{if $share['nickname']}{$share['nickname']}的{if $bl['fzname']}{$bl['fzname']}{else}分站{/if}{/if}{$views['itemtitle']}</title>
		<link rel="stylesheet" href="{$_W['siteroot']}addons/tiger_newhu/template/mobile/tbgoods/style99/css/slicy.css">
		<link rel="stylesheet" href="{$_W['siteroot']}addons/tiger_newhu/template/mobile/tbgoods/style99/css/glide.css">
		<link rel="stylesheet" href="{$_W['siteroot']}addons/tiger_newhu/template/mobile/tbgoods/style99/css/video-js.css">		
		<link rel="stylesheet" href="{$_W['siteroot']}addons/tiger_newhu/template/mobile/tbgoods/style99/css/zys_style.css">
        <script src="{$_W['siteroot']}addons/tiger_newhu/template/mobile/tbgoods/style9/js/jweixin-1.0.0.js"></script>
        <script type="text/javascript" src="{$_W['siteroot']}addons/tiger_newhu/template/mobile/tbgoods/style99/js/jquery-1.7.2.min.js"></script>
				<script type="text/javascript" src="{$_W['siteroot']}addons/tiger_newhu/template/mobile/tbgoods/style99/js/clipboard.min.js"></script>
	</head>
<script>

        var appid = "{$_W['account']['jssdkconfig']['appId']}";
        var timestamp = "{$_W['account']['jssdkconfig']['timestamp']}";
        var nonceStr = "{$_W['account']['jssdkconfig']['nonceStr']}";
        var signature = "{$_W['account']['jssdkconfig']['signature']}";
        wx.config({
            debug: false,
            appId: appid,
            timestamp: timestamp,
            nonceStr: nonceStr,
            signature: signature,
            jsApiList: [
                "onMenuShareAppMessage",
                "onMenuShareTimeline",
                "chooseImage",
                "uploadImage",
                "downloadImage"
            ]
        });

	wx.ready(function(){

		wx.hideOptionMenu();
//		wx.onMenuShareAppMessage({
//			title: "【券后价：{$views['itemendprice']}元】 {$views['itemtitle']}",
//			desc: "{$views['title']}",
//			link: window.location.href ,
//			imgUrl: "{php echo tomedia($views['itempic'])}"
//		}); 
//		wx.onMenuShareTimeline({
//			title: "【券后价：{$views['itemendprice']}元】 {$views['itemtitle']}",
//			desc: "{$views['title']}",
//			link: window.location.href,
//			imgUrl: "{php echo tomedia($views['itempic'])}"
//		});
	});
</script>
<!-- 微信自定义接口 -->
	<body>
		<div class="layout layout_prod_xq">
			<!--<div class="header">
				<div class="left">
					<a href="#" class="back"></a>
				</div>
				<div class="txt">
					<h2>商品详情</h2>
				</div>
				<div class="right">
					<a href="#" class="more"></a>
				</div>
			</div>-->
			<div class="goods_vw">
				<div class="img" id="img_video">
					{if $views['videoid']==0}
					<img src="{$views['itempic']}" width="640" height="640">
					{else}
					<video width="640" height="640" poster="{$views['itempic']}" class="video-js vjs-big-play-centered" id="example_video_1" data-setup='{}' controls>
						<source src="http://cloud.video.taobao.com/play/u/1/p/1/e/6/t/1/{$views['videoid']}.mp4" type="video/mp4"></source>
						             
						<!--<source src="myvideo.ogv" type="video/ogg"></source>
						<source src="myvideo.webm" type="video/webm"></source>-->
						<object width="" height="" type="application/x-shockwave-flash" data="myvideo.swf">
							<param name="movie" value="myvideo.swf" />
							<param name="flashvars" value="autostart=true&amp;file=myvideo.swf" />
						</object>
						当前浏览器不支持 video直接播放，点击这里下载视频： <a href="myvideo.webm">下载视频</a>
					</video>
					{/if}
					<!--<a href="#" class="btn_a" id="btn_a"></a>-->
				</div>
				<div class="back">
					<a href="javascript:void(0);" onclick="history.go(-1);"><img src="{$_W['siteroot']}addons/tiger_newhu/template/mobile/tbgoods/style99/imgs/zys_img19.png" width="60"/></a>
				</div>
				<div class="nav">
					<ul>
						<li>
							<a href="{php echo $this->createMobileUrl('index',array('pid'=>$pid,'dluid'=>$dluid))}"><img src="{$_W['siteroot']}addons/tiger_newhu/template/mobile/tbgoods/style99/imgs/zys_img20.png" width="60"/></a>
						</li>
						<li>
							<a href="javascript:void(0);" id="open_fullimg_btn"><img src="{$_W['siteroot']}addons/tiger_newhu/template/mobile/tbgoods/style99/imgs/zys_img21.png" width="60"/></a>
						</li>
                        {if $cfg['viewtk']==1}
                        {else}
						<li>
							<a href="{php echo $this->createMobileUrl('cqlist',array('pid'=>$pid,'dluid'=>$dluid,'key'=>$views['itemtitle']))}"><img src="{$_W['siteroot']}addons/tiger_newhu/template/mobile/tbgoods/style99/imgs/ss.png" width="60"/></a>
						</li>
                        {/if}
					</ul>
				</div>
			</div>
			<div class="goods_qiang">
				<div class="left" {if $views['itemprice']=='0.00'}style="width:100%"{/if}>
					<big>&yen;</big><span>{$views['itemendprice']}</span> {if $views['itemprice']<>'0.00'}<s>/ &yen;{$views['itemprice']}</s>{else}<s>/ &yen;{php echo $views['itemendprice']+$views['couponmoney']}</s>{/if}
				</div>
				{if $views['itemprice']<>'0.00'}
				<div class="right">
					<h4>距离结束还剩</h4>
					<!--插件-->
					<div class="colockbox_xq" id="colockbox_xq">
						<span class="hour"></span>
						<span class="minute"></span>
						<span class="second"></span>
					</div>
				</div>
				{/if}
			</div>
			<div class="goods_mt">
				<h2><a href="#">{$views['itemtitle']}</a></h2>
				<h4>
					{if $views['couponmoney'] && $views['couponmoney']!=undefined}<span class="huanf" style="color: #FFFFFF;padding-left: 10px; padding-right: 10px; display: inline-block;">券:{$views['couponmoney']}元</span>{/if}
					{if $views['itemsale']}<span class="huans" style="color: #FFFFFF;padding-left: 10px; padding-right: 10px; display: inline-block;">销量:{$views['itemsale']}</span> {/if}
					{if $flyj<>'0.00'}{if $cfg['rxyjxs']==1}{if $flyj}<span class="huanr" style="color: #ffffff;padding-left: 10px; padding-right: 10px; display: inline-block;">奖:{if $dlyj}{$flyj}{else}{$flyj}{$lx}{/if}</span>{/if}{/if}{/if}					
				</h4>
				
				
			</div>
			{if $cfg['tljtype']==1}
			<div class="tlj" id="tlj">申请淘礼金</div>
			<div class="tlj" style="font-size:18px;background:#fffedf;border: 1px #ebdebc solid;color: #ceb35c;line-height:25px; text-align: left;padding: 6px;width: 626px;margin-top: 0;">淘礼金申请成功后，请务必在当天之内领取使用，否则失效 ，如果多次恶意申请而不使用奖被列入黑名单</div>
			{/if}
			<style>
				.huanf{background: #FF0042;padding-left:5px;padding-right: 5px;}
				.huans{background: #FF4200;padding-left:5px;padding-right: 5px;}
				.huanr{background: #009900;padding-left:5px;padding-right: 5px;}
				.tlj{display: inline-block;float:right; background: #009aef;color: #fff;width: 636px;line-height: 60px;text-align: center;font-size: 24px;margin-top: 6px;border: 2px #ffffff dashed;}
			</style>
			<script>
				$("#tlj").click(function(){
					var yj="{$views['tkrates']}";
					var endprice="{$views['itemendprice']}";
					var zdyj="{$cfg['tljyj']}";
					var yj=yj*endprice/100;
					var itemid="{$views['itemid']}";
					if(yj<zdyj){
						alert("该商品暂不参加淘礼金活动");
						return;
					}
					
					$("#tlj").html("淘礼金申请提交中！！");
					$.ajax({
								url:"{php echo $this->createMobileUrl('viewtlj')}",
									type:'post',
									data:{
										itemid:itemid,
										yj:yj,
										pid:"{$cfg['ptpid']}",
										pic:"{$views['itempic']}",
										title:"{$views['itemtitle']}"
									},
								dataType:"json", 
								success: function (data) {
									
									if(data.err==1){
										alert(data.message);
										$("#tlj").html("申请淘礼金！！");
										return;
									}else{
										$("#mask").fadeIn();
										$("#tlj_buy").fadeIn();
										$("#divcass").val(data.kl);
													//alert(data.kl);
													var aaaclipboard = new Clipboard("#cassbtn");										 		
													aaaclipboard.on('success', function(e) {
														 $("#cassbtn").text("复制成功")
														 $("#cassbtn").css("background-color","#18b102");
															console.log(e);
													});										 		
													aaaclipboard.on('error', function(e) {
															console.log(e);
															alert("请长按文本手动复制！")
													});
											$("#tlj").html("申请淘礼金！！");
													
										}
									}
								});
				});

				
			</script>

		
			<div class="pass_buy" id="tlj_buy" style="display: none;height: 260px;" >
				<h2>淘礼金领取购买</h2>
				<div class="" id="tlj_copy_textarea" style="text-align: center;">
					<input type="text" id="divcass" readonly value="" />
				</div>
				<div class="buy_copydiv">
					<a href="javascript:void(0);" class="copy_c" id="cassbtn" data-clipboard-action="copy" data-clipboard-target="#divcass">一键复制</a>
				</div>
				<div class="buy_hint1">
					在点击复制后，请打开 <span></span> 购买
				</div>
				<div class="buy_hint2">
					注：若一键复制失败，请长按 <span></span> 内文字手动复制
				</div>
			</div>
			<style>
				#divcass{    width: 90%;
				text-align:center;
    line-height:60px;
    margin-bottom: 10px;
    margin-top: 10px;
		font-size: 22px;
    border: 2px #ff0000 dashed;}
			</style>
			
			
			<div class="goods_desc">
				<div class="head" id='tigermor' tiger='0'>
					<a href="javascript:;"  >商品图文详情<span id="xq">(点击查看详情)</span></a>
				</div>
				<div class="body">
					<p><span>推荐</span>{$views['itemdesc']}</p>
					<div class="img" id="imgs">
						
					</div>
				</div>
			</div>
			<style>
				#imgs img{
					width: 640px;
					display: block;
					padding: 0;
					margin: 0;
				}
			</style>
			
			<script>
				
			    //function getiteminfo(itemid) {
			    $(document).delegate("#tigermor", "click", function () {
                    var $this = $(this);
			        var itemid="{$views['itemid']}";   
			        var tiger = $this.attr("tiger");
			        if(tiger==1){
			        	 $('#imgs').hide();
		                 $("#tigermor").attr('tiger','0');
		                 $('#xq').html("(点击查看详情)");
			        }else{
			        	 $("#tigermor").attr('tiger','1');
			        	 $('#imgs').show();
			        	$('#xq').html("加载中，请稍候！");
// 				        $.ajax({
// 				            //url: "https://hws.m.taobao.com/cache/mtop.wdetail.getItemDescx/4.9/?data=%7Bitem_num_id%3A" + itemid + "%7D&type=jsonp&dataType=jsonp",
// 										url:'{php echo $this->createMobileUrl("tbviewimg")}&itemid='+itemid,
// 				            dataType: 'jsonp',
// 				            jsonp: 'callback',
// 				            success: function (result) {
// 											alert(result);
// 				                if (result.ret[0] == "SUCCESS::接口调用成功") {
// 				                    var len = result.data.images.length;
// 				                    var image = '';
// 				                    for (var i = 0; i < len; i++) {
// 				                        image+= '<img src="' + result.data.images[i] + '">';
// 				                    }    
// 		                           $('#xq').html(" (加载完成！请查看！)");
// 				                    $('#imgs').html(image);
// 				                } else {
// 				                    $("#imgs").html("宝贝数据调用失败，原因：" + result.ret[0]);
// 				                    $('#imgs').modal();
// 				                }
// 				            }
// 				        });
								
								$.ajax({
												url:"{php echo $this->createMobileUrl('tbviewimg')}",
													type:'post',
													data:{
														itemid:itemid,
													},
												dataType:"json", 
												success: function (data) {
													$('#xq').html(" (加载完成！请查看！)");
													$('#imgs').html(data.data);
													// alert(data.data);
												}
									});
								
								
								
			        }
			       
			       
			        
			    });
			</script>

			<div class="goods_tj goods_jp">
				<div class="head">
					<a href='{php echo $this->createMobileUrl("newcat",array("type"=>$views["fqcat"],"lm"=>$cfg['mmtype'],"pid"=>$pid))}'>本栏目更多精品</a>
				</div>
				<div class="body">
					<ul>
						{loop $viewslist $v}
						<li>
							{if $v['videoid']}
							<div class="img v_btn_img">
						    {else}
						    <div class="img">
						    {/if}
								<a href='{php echo $this->createMobileUrl("view",array("itemid"=>$v["itemid"],"lm"=>$cfg['mmtype'],"pid"=>$pid))}'><img src="{$v['itempic']}" style="width: 290px;height:290px;"/><h4>销量：{$v['itemsale']}</h4></a>
								
							</div>
							<div class="txt">
								<h2><a href='{php echo $this->createMobileUrl("view",array("itemid"=>$v["itemid"],"lm"=>$cfg["mmtype"],"pid"=>$pid))}' {if $v['shoptype']=='B'} id="tmion" {/if}>{$v['itemtitle']}</a></h2>
								<h4><big>&yen;{$v['itemendprice']}</big> <s>&yen;{$v['itemprice']}</s> <!--span class="fan">0.5</span--></h4>
							</div>
							<div class="btn">
								<a href='{php echo $this->createMobileUrl("view",array("itemid"=>$v["itemid"],"lm"=>$cfg['mmtype'],"pid"=>$pid))}'>立减{$v['couponmoney']}元</a>
							</div>
						</li>
						{/loop}
					</ul>
				</div>
			</div>
            <style>
               #tmion {
                    background: url({$_W['siteroot']}addons/tiger_newhu/template/mobile/tbgoods/style99/imgs/img32.png) no-repeat;background-position-y: 7px;
                }

            </style>


			<div class="mask" id="mask" style="display: none;">
				
			</div>
			
			<div class="full_img" id="full_img" style="display: none;top:85px">				
				
				<p id="rwmtp"></p>
				<div class="" id="copy_textarea1" style="background: #fff;padding: 6px;overflow: scroll;height: 50px;">
					 <textarea readonly name="" rows="" cols="" id="copy_key_android1">{$msg}&nbsp;</textarea>
					 <div id="copy_key_ios1" style="" class="xq_ios_txt">{$msg}&nbsp;</div>
				</div>
				<a href="javascript:void(0);" class="fuzhi123" id="fuzhi123" data-clipboard-action="copy" data-clipboard-target="#copy_textarea1">复制文案</a>
				<a href="javascript:void(0);" class="fullimg_close" id="fullimg_close" style="left: 41%;    margin-top: 20px;"></a>
			</div>
			
		
			
			<style>
				    .fuzhi123{font-size: 24px;
							display: block;
							background: #ff7200;
							width: 123px;
							height: 50px;
							line-height: 50px;
							color: #fff;
							border-radius: 6px;
							text-align: center;
							position: absolute;		
							right: 1px;}
							.fuzhi123.hover{text-decoration:none;}
				</style>
			
			<div class="cus_service_img" id="cus_service_img" style="display: none;">
				<img src="{php echo tomedia($cfg['kfewm'])}"/>
			</div>
			<div class="pass_buy" id="pass_buy" style="display: none;">
				<h2>淘口令购买</h2>
				<div class="" id="copy_textarea">
					<textarea readonly name="" rows="" cols="" id="copy_key_android">{$msg}</textarea>
	                <div id="copy_key_ios" style="" class="xq_ios_txt">{$msg}</div>
				</div>
				<div class="buy_copydiv">
					{if $cfg['rxyjxs']==1}
						{if $flyj}
						<div class="get_price">
							<font>预计返</font>
							<span>{$flyj}{$lx}</span>
						</div>
						{/if}
					{/if}
					
					<a href="javascript:void(0);" class="copy_c" id="copy_c" data-clipboard-action="copy" data-clipboard-target="#copy_textarea">一键复制</a>
				</div>
				<div class="buy_hint1">
					在点击复制后，请打开 <span></span> 购买
				</div>
				<div class="buy_hint2">
					注：若一键复制失败，请长按 <span></span> 内文字 或 用【浏览器领券】模式
				</div>
			</div>
			
			
			
			<div class="goods_foot">
				<div class="nav">
					<ul>
						<li>
							<a href="{php echo $this->createMobileUrl('index',array('pid'=>$pid,'dluid'=>$dluid))}"><i class="sy"></i><span>首页</span></a>
						</li>
						<li>
							<a href="javascript:void(0);" id="cus_service" style="width: 120px;"><i class="kf"></i><span>客服</span></a>
						</li>
					</ul>
				</div>

            


				<div class="btn">
					<ul>
                    {if $views['tj']==2}
                       {if $kj==1}
						<li>              
                            {if $cfg['llqtype']==1}
                            <a href="javascript:void(0);" style="background-color: #f0f0f0;"></a>
                            {else}
                                {if $cfg['ljqtzapp']==1}
                                    <a href="javascript:" onclick="opengo();">立即购买</a>
                                {else}
                                  <a href="{php echo $this->createMobileUrl('openview',array('dluid'=>$dluid))}&link={$rhyurl}" >浏览器领券</a>
                                {/if}
                            {/if}
						</li>
						<li class="bgred">
							{if $_GPC['gopturl']}
							<a href="javascript:void(0);" id="pass_buy_btn">去拼团</a>
							{else}
							<a href="javascript:void(0);" id="pass_buy_btn">淘口令领券</a>
							{/if}
						</li>
                       {else}
                       <li>
                            <a href="javascript:void(0);" style="background-color: #f0f0f0;"></a>
						</li>
						<li class="bgred">
							<a href="javascript:void(0);" style="background-color: #777777;">即将开抢</a>
						</li>

                       {/if}
                    {else}
                       <li>                       
                            {if $cfg['llqtype']==1}
                            <a href="javascript:void(0);" style="background-color: #f0f0f0;"></a>
                            {else}
                                {if $cfg['ljqtzapp']==1}
																    {if $_GPC['gopturl']}
                                    <a href="javascript:" onclick="opengo();">去拼团</a>
																		{else}
																		<a href="javascript:" onclick="opengo();">立即购买</a>
																		{/if}
                                {else}
                                  <a href="{php echo $this->createMobileUrl('openview',array('dluid'=>$dluid))}&link={$rhyurl}" >浏览器领券</a>
                                {/if}
                            {/if}
						</li>
						<li class="bgred">
							{if $_GPC['gopturl']}
							<a href="javascript:void(0);" id="pass_buy_btn">去拼团</a>
							{else}
							<a href="javascript:void(0);" id="pass_buy_btn">淘口令领券</a>
							{/if}
						</li>
                    {/if}
					</ul>
				</div>
				<div href="###" class="toTop" id="toTop" style="display: none;"></div>
			</div>
			
		</div>

		
		<script type="text/javascript" src="{$_W['siteroot']}addons/tiger_newhu/template/mobile/tbgoods/style99/js/jquery.mobile-1.0.1.min.js"></script>
		<script type="text/javascript" src="{$_W['siteroot']}addons/tiger_newhu/template/mobile/tbgoods/style99/js/jquery.countDown.js"></script>
		<script type="text/javascript" src="{$_W['siteroot']}addons/tiger_newhu/template/mobile/tbgoods/style99/js/jquery.glide.js"></script>
		
		<script type="text/javascript" src="{$_W['siteroot']}addons/tiger_newhu/template/mobile/tbgoods/style99/js/video.min.js"></script>
		<script type="text/javascript" src="{$_W['siteroot']}addons/tiger_newhu/template/mobile/tbgoods/style99/js/script.js"></script>
		<script src="{$_W['siteroot']}addons/tiger_newhu/template/mobile/js/layer_mobile/layer.js"></script>
        <link href="{$_W['siteroot']}/addons/tiger_newhu/template/mobile/js/layer_mobile/need/layer.css" rel="stylesheet" />
		<script>

        //https://t.asczwa.com/taobao?backurl={$rhyurl}

        function opengo(){
           var ua = window.navigator.userAgent.toLowerCase();
            //alert(ua);
                    if(ua.match(/iphone/i) == "iphone" || ua.match(/ipad/i) == "ipad"){
                       window.location.href='https://t.asczwa.com/taobao?backurl={$rhyurl}';
                    }else{        
                    	//window.location.href='https://t.asczwa.com/taobao?backurl={$rhyurl}';
                        window.location.href="{php echo $this->createMobileUrl('go')}&url={php echo urlencode($rhyurl)}";
                    }
         }

			
         var views="{$views['itemtitle']}";
          	//alert(views);
        	if(views==''){
        		//信息框
				    layer.open({
					    content: '对不起！商品已下架！'
					    ,btn: ['返回首页']
					    ,yes: function(index){
					      window.location.href="{php echo $this->createMobileUrl('index',array('pid'=>$pid,'dluid'=>$dluid))}"; 
					    }
					  });
        	}
        </script>
		<canvas id="sharecanvas" style="background-color:white; width:80%;display: none;" class="am-text-center am-center"></canvas>
		<script type="text/javascript">
			$(function(){

				//到2019/8/10 22:59:59，计算出到这个时间还有多长时间，并显示
				countDown("{$ctime}",null,"#colockbox_xq .hour","#colockbox_xq .minute","#colockbox_xq .second");

//商品海报

		$("#open_fullimg_btn").click(function(){//商品二维码	
			if($('#rwmtp').html()!=""){
				$("#mask").fadeIn();
	            $("#full_img").fadeIn();
	            return false;
			}
		    layer.open({
			    type: 2
			    ,content: '正在为您生成图片,请稍后！'
			    ,time: 1000
			 });
			 var code_img_src='';
			$.ajax({
	            url:"{php echo $this->createMobileUrl('getewm')}",
	              type:'post',
	              data:{
	              	url:encodeURIComponent("{$ewmurl}"),
	              },
	            dataType:"json", 
	            success: function (data) {
	             code_img_src=data;	 
	             canvasApp(code_img_src);
	             console.log(code_img_src);
	            }
	     	});
		    
		});

		function canvasApp(code_img_src) {	
                var is_agent = window.localStorage.getItem('is_agent') || 0;
                var p_id = window.localStorage.getItem('adzone_pname') || '';
          
                var canvas = document.getElementById('sharecanvas');
                var ctx = canvas.getContext('2d');   		        
                ctx.fillStyle = "#fff";  
                canvas.width = 640;
                canvas.height = 896; 
                var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                for(var i = 0; i < imageData.data.length; i += 4) {
                    // 当该像素是透明的，则设置成白色
                if(imageData.data[i + 3] == 0) {
                    imageData.data[i] = 255;
                    imageData.data[i + 1] = 255;
                    imageData.data[i + 2] = 255;
                    imageData.data[i + 3] = 255; 
                    }
                }
                ctx.putImageData(imageData, 0, 0);

            /*商品主图*/                
            var bj_img = new Image();
            bj_img.setAttribute('crossOrigin','anonymous');
            //bj_img.src = "{$_W['siteroot']}addons/tiger_newhu/hb/bj.jpg"; 
            bj_img.src = "/addons/tiger_newhu/hb/bj1.jpg"; 
            bj_img.onload = function(){
			    ctx.drawImage(bj_img, 0, 0, canvas.width, canvas.height);
			    var item_img = new Image();
                item_img.setAttribute('crossOrigin','anonymous');
                item_img.src = "{$views['itempic']}";
                //'https://img.alicdn.com/bao/uploaded/i2/357274591/TB1anbaeMvD8KJjSsplXXaIEFXa_!!0-item_pic.jpg'
                item_img.onload = function(){
					ctx.drawImage(item_img, 0, 0, canvas.width, canvas.width);
					/*二维码*/
					var code_img = new Image();
					code_img.setAttribute('crossOrigin','anonymous');
					//code_img.src = "{$_W['siteroot']}app/index.php?i={$_W['uniacid']}&c=entry&do=images&m=tiger_newhu&url="+ encodeURIComponent('http://qr.liantu.com/api.php?m=10&w=200&text='+encodeURIComponent(1111));
					code_img.src=code_img_src;
//					console.log(code_img.src);
//	
					code_img.onload = function() {
						ctx.drawImage(code_img, canvas.width - 205,canvas.width + 30,175, 175);
					

					/*图标*/
					var shoptype="{$views['shoptype']}";
					var tb_img = new Image();
					tb_img.setAttribute('crossOrigin','anonymous');
					if(shoptype=='B'){
						tb_img.src="/addons/tiger_newhu/hb/tm.png";
					}else{
						tb_img.src="/addons/tiger_newhu/hb/tb.png";
					}
//					alert(shoptype);
					
//	
					tb_img.onload = function() {
				    //ctx.drawImage(tb_img, canvas.width - 600,canvas.width -80,50, 50);
				    ctx.drawImage(tb_img, canvas.width -620,canvas.width +28,35, 35);
				    

						/*商品标题*/
						var str = "                 {$views['itemtitle']}";
						ctx.fillStyle='#605761';
						ctx.lineWidth=1; 
						ctx.textAlign = 'left';
						ctx.textBaseline = "top";
						ctx.font = '24px 微软雅黑';
						var lineWidth = 0;
						var canvasWidth = canvas.width - 60;//计算canvas的宽度
						var initHeight= canvas.width + 30;//绘制字体距离canvas顶部初始的高度
						var lastSubStrIndex= 0; //每次开始截取的字符串的索引
						for(var i = 0;i <= str.length; i++){ 
							lineWidth += ctx.measureText(str[i]).width; 
							if(lineWidth > canvasWidth - 230){ 
								ctx.fillText(str.substring(lastSubStrIndex,i),20,initHeight);//绘制截取部分
								initHeight += 40;//字体的高度
								lineWidth = 0;
								lastSubStrIndex = i;
							} 
							if(i == str.length - 1 ){
								ctx.fillText(str.substring(lastSubStrIndex,i + 1 ),20,initHeight);
							}
						}
						
						/*现价*/
						 var price = '现价：';
						ctx.fillStyle = '#aba0ac';
						ctx.textAlign = 'left';
						ctx.font = '20px 微软雅黑';
						ctx.textBaseline = "top";
						ctx.fillText(price,20,initHeight + 40);
						
						/*现价*/
						 var price = "¥ {$views['itemprice']}";
						ctx.fillStyle = '#aba0ac';
						ctx.textAlign = 'left';
						ctx.font = '20px Helvetica';
						ctx.textBaseline = "top";
						ctx.fillText(price,80,initHeight + 40);

						/*删除线*/
						ctx.strokeStyle = '#aba0ac';
						ctx.lineWidth = 1; // 改变线的粗细 
						ctx.moveTo(70, initHeight + 50); // 起始点 
						ctx.lineTo(140, initHeight + 50); // 第二点(如果是一条直线的话，就是终点) 
						ctx.stroke();

						/*在售标题*/
						var end_price_title = '券后价:';
						ctx.fillStyle = '#aba0ac';
						ctx.textAlign = 'left';
						ctx.font = '20px 微软雅黑';
						ctx.textBaseline = "top";
						ctx.fillText(end_price_title,120,initHeight +87);

						/*在售价格*/
						var end_price = "¥ {$views['itemendprice']}";
						ctx.fillStyle = '#FF4E12';
						ctx.textAlign = 'left';
						ctx.font = '36px Helvetica';
						ctx.textBaseline = "top";
						ctx.fillText(end_price,190,initHeight + 75);
				
						 /*秘券金额*/
						  var end_price = "{$views['couponmoney']}元";
						  ctx.fillStyle = '#FF4E12';
						  ctx.textAlign = 'left';
						  ctx.font = '20px Helvetica';
						  ctx.textBaseline = "top";
						  ctx.fillText(end_price,55,initHeight + 87);


						/*保存为图片*/
						var image = new Image();
						image.setAttribute('crossOrigin','anonymous');
						image.src = canvas.toDataURL("img/png");
			
						//$(".imgData").attr("background","white");
						//$(".imgData").attr("src",image.src);
						if(image.src){
							$("#layui-m-layer0").css("display","none");
						}
		                $("#mask").fadeIn();
				        $("#full_img").fadeIn();
						$("#rwmtp").html("<img style='width:490px;height:700px;display:block' src='"+image.src+"'>");

						
					}
					}
				}
           }

		}
//海报
				
				$("#fullimg_close,#mask").click(function(){
					$("#mask").fadeOut();
					$("#full_img").fadeOut();
					$("#cus_service_img").fadeOut();
					$("#pass_buy").fadeOut();
					$("#tlj_buy").fadeOut();
					$("#copy_c").text("一键复制")
					$("#copy_c").css("background-color","#ff2e48");
				});
				
				$("#cus_service").click(function(){
					$("#mask").fadeIn();
					$("#cus_service_img").fadeIn();
				});
				
				
				//淘口令领券
				$("#pass_buy_btn").click(function(){
					$("#mask").fadeIn();
					$("#pass_buy").fadeIn();
				});
				
				//init 复制粘贴按钮
				var clipboard = new Clipboard('#copy_c');
				//优雅降级:safari 版本号>=10,提示复制成功;否则提示需在文字选中后，手动选择“拷贝”进行复制
				clipboard.on('success', function(e) {
					$("#copy_c").text("复制成功")
					$("#copy_c").css("background-color","#18b102");
					console.log(e)
					e.clearSelection();
				});
				clipboard.on('error', function(e) {
					alert('请长按文本进行复制!')
				});
				
				
				var yjclipboard=new Clipboard('#fuzhi123');
				yjclipboard.on('success', function(e) {
					$("#fuzhi123").text("复制成功")
					$("#fuzhi123").css("background-color","#18b102");
					e.clearSelection();
					console.log(e)
				});
				yjclipboard.on('error', function(e) {
					alert('请长按文本进行复制!')
				});
				
				//根据ios或者Android显示不同的文本标签元素
				$(function(){
					if (isIos()){
						$('#copy_key_ios').show();
						$('#copy_key_android').hide();
						$('#copy_c').attr("data-clipboard-target","#copy_key_ios");
						$('#copy_key_ios1').show();
						$('#copy_key_android1').hide();
						$('#fuzhi123').attr("data-clipboard-target","#copy_key_ios1");
					}
					else{
						$('#copy_key_ios').hide();
						$('#copy_key_android').show();
						$('#copy_c').attr("data-clipboard-target","#copy_key_android");
						$('#copy_key_ios1').hide();
						$('#copy_key_android1').show();
						$('#fuzhi123').attr("data-clipboard-target","#copy_key_android1");
					}
				
				});
				
				
				
				
				
				var browser = {
				    versions: function () {
				        var u = navigator.userAgent, app = navigator.appVersion;
				        return { //移动终端浏览器版本信息
				            trident: u.indexOf('Trident') > -1, //IE内核
				            presto: u.indexOf('Presto') > -1, //opera内核
				            webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
				            gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
				            mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
				            ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
				            android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1 || u.indexOf("Adr"), //android终端或uc浏览器
				            iPhone: u.indexOf('iPhone') > -1, //是否为iPhone或者QQHD浏览器
				            iPad: u.indexOf('iPad') > -1, //是否iPad
				            webApp: u.indexOf('Safari') == -1 //是否web应该程序，没有头部与底部
				        };
				    }(),
				    language: (navigator.browserLanguage || navigator.language).toLowerCase()
				};
				//是否为ios   if(isIos()) {}
				function isIos() {
				    return browser.versions.ios || browser.versions.iPhone || browser.versions.iPad
				}

							
				
			});

// 				document.addEventListener("selectionchange", function(e) {
// 					if(window.getSelection().anchorNode.parentNode.id == 'copy_key_ios' || window.getSelection().anchorNode.id == 'copy_key_ios') {
// 					    var key = document.getElementById('copy_key_ios');
// 						window.getSelection().selectAllChildren(key);
// 					}
// 					if(window.getSelection().anchorNode.parentNode.id == 'copy_key_android' || window.getSelection().anchorNode.id == 'copy_key_android') {
// 					    var key = document.getElementById('copy_key_android');
// 						window.getSelection().selectAllChildren(key);
// 					}
// 				}, false);


                 

		</script>
		{if $cfg['lbtx']==1}
<script>
	//悬浮框 
	var fixeddata = [
	{loop $msg1 $v}
	    {
	        name: "{$v['title']}",
	        content: "{$v['content']}",
	        headerportarit: "{php echo tomedia($v['picurl'])}"
	    },
	{/loop}	
	];
	var i = 0;
    if (window.location.href.indexOf("index") > -1) {
        setInterval(function () {
            userAction(fixeddata[i].name, fixeddata[i].content, fixeddata[i].headerportarit);
            setTimeout(function () {
                $(".useract").removeClass("useractshow");
            }, 3000)
            i++;
            if (i == fixeddata.length) {
                i = 0;
            }
        }, 5000)
    }
    /*悬浮提示框*/
	function userAction(name, content, headerportrait) {
	    var act;
	    if (!document.querySelector(".useract")) {
	        var useract = document.createElement("div");
	        document.body.appendChild(useract);
	        useract.className = "useract";
	
	    }
	    act = document.querySelector(".useract");
	    act.innerHTML = "<img src='" + headerportrait + "'>" + name + ":" + content;
	    act.classList.add("useractshow");
	}
</script>

    <style>
	 .useract {
	    position: fixed;
	    opacity: 0;
	    color: #fff;
	    border-radius: 20px;
	    height: 40px;
	    line-height: 40px;
	    font-size: 18px;
	    left: 0.2rem;
	    padding-right: 10px;
	    top: 6rem;
	    z-index: 2000;
	    background: #000;
	}
	
	.useract img {
	    width: 35px;
	    height: 35px;
	    border-radius: 18px;
	    vertical-align: -10px;
	    margin-right: 8px;
	}
	
	.useractshow {
	    opacity: 0.8;
	    transition: all 0.3s;
	    -webkit-transition: all 0.3s;
	}
	</style>
	{/if}
	</body>

</html>